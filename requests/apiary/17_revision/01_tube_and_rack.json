
{"steps":[{"header":["Accept: application/json"],"response_header":["Content-Type: application/json"],"description":"","method":"GET","url":"11111111-2222-3333-1111-111111111111/sessions/#{session_id1}","session_id1":"#{session_id1}","status":200,"response":"{\n  \"tube\":{\n    \"actions\":{\n      \"read\":\"http://example.org/11111111-2222-3333-1111-111111111111/sessions/#{session_id1}\"\n    },\n    \"uuid\":\"11111111-2222-3333-1111-111111111111\",\n    \"action\":\"insert\",\n    \"session\": {\n      \"actions\": {\n        \"read\": \"http://example.org/sessions/#{session_id1}\"\n      },\n      \"id\": \"*#{session_id1}*\",\n      \"user\": null,\n      \"backend_application_id\": null,\n      \"parameters\": \"null\",\n      \"success\": true,\n      \"start_time\": \"2014-01-01 00:00:00 +0000\",\n      \"end_time\": \"2014-01-02 00:00:00 +0000\"\n    },\n  \"location\":null,\n    \"type\":null,\n    \"max_volume\":null,\n    \"aliquots\":[\n      {\n        \"sample\":{\n      \"actions\": {\n        \"read\": \"http://example.org/11111111-2222-3333-0000-111111111111/sessions/#{session_id1}\"\n      },\n          \"uuid\":\"11111111-2222-3333-0000-111111111111\",\n          \"name\":\"sample 1\"\n        },\n        \"quantity\":10,\n        \"type\":\"DNA\",\n        \"unit\":\"mole\"\n      }\n    ]\n}\n}\n"},{"header":["Accept: application/json"],"response_header":["Content-Type: application/json"],"description":"","method":"GET","url":"11111111-2222-3333-2222-111111111111/sessions/#{session_id1}","session_id1":"#{session_id1}","status":200,"response":"{\n  \"tube_rack\": {\n      \"actions\": {\n        \"read\": \"http://example.org/11111111-2222-3333-2222-111111111111/sessions/#{session_id1}\"\n      },\n      \"uuid\": \"11111111-2222-3333-2222-111111111111\",\n      \"action\": \"insert\",\n      \"location\": null,\n      \"number_of_rows\": 8,\n      \"number_of_columns\": 12,\n      \"tubes\": {\n      },\n      \"session\": {\n        \"actions\": {\n          \"read\": \"http://example.org/sessions/#{session_id1}\"\n        },\n        \"id\": \"*#{session_id1}*\",\n        \"user\": null,\n        \"backend_application_id\": null,\n        \"parameters\": \"null\",\n        \"success\": true,\n        \"start_time\": \"2014-01-01 00:00:00 +0000\",\n        \"end_time\": \"2014-01-02 00:00:00 +0000\"\n      }\n    }\n}\n"},{"header":["Accept: application/json"],"response_header":["Content-Type: application/json"],"description":"","method":"GET","url":"11111111-2222-3333-1111-111111111111/sessions/#{session_id2}","session_id2":"#{session_id2}","status":200,"response":"{\n  \"tube\":{\n    \"actions\":{\n      \"read\":\"http://example.org/11111111-2222-3333-1111-111111111111/sessions/#{session_id2}\"\n    },\n    \"uuid\":\"11111111-2222-3333-1111-111111111111\",\n    \"action\":\"insert\",\n    \"session\": {\n      \"actions\": {\n        \"read\": \"http://example.org/sessions/#{session_id2}\"\n      },\n      \"id\": \"*#{session_id2}*\",\n      \"user\": null,\n      \"backend_application_id\": null,\n      \"parameters\": \"null\",\n      \"success\": true,\n      \"start_time\": \"2014-01-02 00:00:00 +0000\",\n      \"end_time\": \"2014-01-03 00:00:00 +0000\"\n    },\n  \"location\":null,\n    \"type\":null,\n    \"max_volume\":null,\n    \"aliquots\":[\n      {\n        \"sample\":{\n      \"actions\": {\n        \"read\": \"http://example.org/11111111-2222-3333-0000-111111111111/sessions/#{session_id2}\"\n      },\n          \"uuid\":\"11111111-2222-3333-0000-111111111111\",\n          \"name\":\"sample 1\"\n        },\n        \"quantity\":10,\n        \"type\":\"DNA\",\n        \"unit\":\"mole\"\n      }\n    ]\n}\n}\n"},{"header":["Accept: application/json"],"response_header":["Content-Type: application/json"],"description":"","method":"GET","url":"11111111-2222-3333-2222-111111111111/sessions/#{session_id2}","session_id2":"#{session_id2}","status":200,"response":"{\n  \"tube_rack\": {\n      \"actions\": {\n        \"read\": \"http://example.org/11111111-2222-3333-2222-111111111111/sessions/#{session_id2}\"\n      },\n      \"uuid\": \"11111111-2222-3333-2222-111111111111\",\n      \"action\": \"insert\",\n      \"location\": null,\n      \"number_of_rows\": 8,\n      \"number_of_columns\": 12,\n      \"tubes\": {\n        \"A1\": {\n            \"actions\": {\n              \"read\": \"http://example.org/11111111-2222-3333-1111-111111111111/sessions/#{session_id2}\"\n            },\n            \"uuid\": \"11111111-2222-3333-1111-111111111111\",\n            \"location\": null,\n            \"type\": null,\n            \"max_volume\": null,\n            \"aliquots\": [\n              {\n                \"sample\": {\n                  \"actions\": {\n                    \"read\": \"http://example.org/11111111-2222-3333-0000-111111111111/sessions/#{session_id2}\"\n                  },\n                  \"uuid\": \"11111111-2222-3333-0000-111111111111\",\n                  \"name\": \"sample 1\"\n                },\n                \"quantity\": 10,\n                \"type\": \"DNA\",\n                \"unit\": \"mole\"\n              }\n            ]\n          }\n          },\n          \"session\": {\n            \"actions\": {\n              \"read\": \"http://example.org/sessions/#{session_id2}\"\n            },\n            \"id\": \"*#{session_id2}*\",\n            \"user\": null,\n            \"backend_application_id\": null,\n            \"parameters\": \"null\",\n            \"success\": true,\n            \"start_time\": \"2014-01-02 00:00:00 +0000\",\n            \"end_time\": \"2014-01-03 00:00:00 +0000\"\n          }\n      }\n}\n"},{"header":["Accept: application/json"],"response_header":["Content-Type: application/json"],"description":"","method":"GET","url":"11111111-2222-3333-1111-111111111111/sessions/#{session_id3}","session_id3":"#{session_id3}","status":200,"response":"{\n  \"tube\":{\n    \"actions\":{\n      \"read\":\"http://example.org/11111111-2222-3333-1111-111111111111/sessions/#{session_id3}\"\n    },\n    \"uuid\":\"11111111-2222-3333-1111-111111111111\",\n    \"action\":\"insert\",\n    \"session\": {\n      \"actions\": {\n        \"read\": \"http://example.org/sessions/#{session_id3}\"\n      },\n      \"id\": \"*#{session_id3}*\",\n      \"user\": null,\n      \"backend_application_id\": null,\n      \"parameters\": \"null\",\n      \"success\": true,\n      \"start_time\": \"2014-01-03 00:00:00 +0000\",\n      \"end_time\": \"2014-01-04 00:00:00 +0000\"\n    },\n  \"location\":null,\n    \"type\":null,\n    \"max_volume\":null,\n    \"aliquots\":[\n      {\n        \"sample\":{\n      \"actions\": {\n        \"read\": \"http://example.org/11111111-2222-3333-0000-222222222222/sessions/#{session_id3}\"\n      },\n          \"uuid\":\"11111111-2222-3333-0000-222222222222\",\n          \"name\":\"sample 2\"\n        },\n        \"quantity\":10,\n        \"type\":\"DNA\",\n        \"unit\":\"mole\"\n      }\n    ]\n}\n}\n"}],"setup":"##################################################\n# Session 1 : create tube and rack\n# Impact : +tube1, +sample1, +sample2, +rack1, +rack2\n##################################################\n\nsample1 = Lims::LaboratoryApp::Laboratory::Sample.new(:name => 'sample 1')\nsample2 = Lims::LaboratoryApp::Laboratory::Sample.new(:name => 'sample 2')\n\ntube1 = Lims::LaboratoryApp::Laboratory::Tube.new \ntube1 << Lims::LaboratoryApp::Laboratory::Aliquot.new(:quantity => 10, :type => \"DNA\", :sample => sample1)\n\nrack1 = Lims::LaboratoryApp::Laboratory::TubeRack.new(:number_of_rows => 8, :number_of_columns => 12)\nrack2 = Lims::LaboratoryApp::Laboratory::TubeRack.new(:number_of_rows => 8, :number_of_columns => 12)\n\nsave_with_uuid({\n  sample1 => [1,2,3,0,1],\n  sample2 => [1,2,3,0,2],\n  tube1 => [1,2,3,1,1],\n  rack1 => [1,2,3,2,1],\n  rack2 => [1,2,3,2,2],\n})\n\nsession_id1 = get_last_session_id\n##################################################\n# Session 2 : put tube in a rack\n# Impact: !tube1, !rack1\n##################################################\n\nstore.with_session do |session|\n  tube = session['11111111-2222-3333-1111-111111111111']\n  rack = session['11111111-2222-3333-2222-111111111111']\n  rack[\"A1\"] = tube\nend\nsession_id2 = get_last_session_id\n\n##################################################\n# Session 3 : swap sample to sample 2\n# Impact : !tube1, !sample1, !sample2, !rack1\n##################################################\n\nstore.with_session do |session|\n  tube = session['11111111-2222-3333-1111-111111111111']\n  sample2 = session['11111111-2222-3333-0000-222222222222']\n  tube[0].sample = sample2\nend\nsession_id3 = get_last_session_id\n\n##################################################\n# Session 4 : move tube in another rack\n# Impact: !tube1, !rack1, !rack2\n##################################################\n\nstore.with_session do |session|\n  tube = session['11111111-2222-3333-1111-111111111111']\n  rack1 = session['11111111-2222-3333-2222-111111111111']\n  rack2 = session['11111111-2222-3333-2222-222222222222']\n  rack1.clear\n  rack2[\"A1\"] = tube\nend\nsession_id4 = get_last_session_id\n\n#  Modify the time of sessions\n\n[session_id1, session_id2, session_id3, session_id4].each_with_index do |id, i|\n  store.database[:sessions].filter(:id => id).update(:end_time => \"2014-01-0#{i+2}\",\n                                                  :start_time => \"2014-01-0#{i+1}\")\nend\n\n\n"}

